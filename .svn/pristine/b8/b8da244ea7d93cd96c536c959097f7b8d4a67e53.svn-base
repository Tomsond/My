package com.thinkive.fxc.ismp.bus.business.certificate.business;

import org.apache.commons.lang.StringUtils;

import com.thinkive.base.util.SpringHelper;
import com.thinkive.fxc.ismp.bus.base.business.constants.BusinessServiceBeanIdConstants;
import com.thinkive.fxc.ismp.bus.base.business.service.SignAndVerifyService;
import com.thinkive.fxc.ismp.bus.base.common.ISMPBaseFunction;
import com.thinkive.fxc.ismp.bus.base.constants.CertConstants;
import com.thinkive.fxc.ismp.bus.base.constants.DictionaryConstants;
import com.thinkive.fxc.ismp.bus.base.constants.ErrorCodeCheckInput;
import com.thinkive.server.ResultVo;

/**
 * @描述: 电子协议数字签名验签(MD5方式)（批量提交） ----通用版本
 * @版权: Copyright (c) 2010
 * @公司: 深圳市思迪信息技术股份有限公司
 * @作者: 刘恺
 * @版本: 2.0.0 
 * @创建时间: 2016年8月30日 下午3:16:37
 */
public class Function1004185 extends ISMPBaseFunction
{
	
	private Long userId;
	
	private String jsondata;
	
	private String signSourceFlag;
	
	private String checksign;
	
	private String certType;
	
	public ResultVo execute() throws Exception
	{
		initVar();
		String signtType = CertConstants.SIGN_TYPE_ZD;
		if (DictionaryConstants.BOL_FALSE.equals(checksign))
		{
			signtType = CertConstants.SIGN_TYPE_NOCERT;
		}
		else if (!StringUtils.isBlank(certType))
		{
			signtType = certType;
		}
		SignAndVerifyService signAndVerifyService = SpringHelper.getBean(BusinessServiceBeanIdConstants.SERVICE_ID_SIGNANDVERIFY, SignAndVerifyService.class);
		signAndVerifyService.verifySignText(userId, jsondata, signtType, signSourceFlag);
		
		ResultVo resultVo = new ResultVo();
		resultVo.setErrorNo(DictionaryConstants.INVOKE_FUNCTION_SUCCESS);
		resultVo.setErrorMsg(DictionaryConstants.INVOKE_FUNCTION_SUCCESSMSG);
		return resultVo;
	}
	
	/**
	 * @描述：获取业务入参
	 * @作者：刘恺
	 * @时间：2016年8月23日 下午8:55:24
	 */
	private void initVar()
	{
		userId = this.formatLongParam(this.getAndCheckBlankStrParam("user_id", ErrorCodeCheckInput.BLANK_USERID), ErrorCodeCheckInput.LONG_FORMAT_ERROR);
		jsondata = this.getAndCheckBlankStrParam("jsondata", ErrorCodeCheckInput.BLANK_SIGNATURE);
		signSourceFlag = this.getStrParameter("sign_source_flag", CertConstants.SIGN_SOURCE_FLAG_MD5);//0：原文，1：md5 2：其他，例如页面div 或者其他问卷原文
		checksign = this.getStrParameter("checksign", DictionaryConstants.BOL_TRUE);//0:不验签；1:验签(默认)
		certType = this.getStrParameter("cert_type", CertConstants.CERT_TYPE_ZD);
	}
}