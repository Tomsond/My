package com.thinkive.fxc.ismp.bus.base.business.function;

import java.util.ArrayList;
import java.util.List;

import com.thinkive.base.jdbc.DataRow;
import com.thinkive.base.util.SpringHelper;
import com.thinkive.fxc.ismp.bus.base.business.constants.BusinessConstants;
import com.thinkive.fxc.ismp.bus.base.business.constants.BusinessServiceBeanIdConstants;
import com.thinkive.fxc.ismp.bus.base.business.service.BusinessLableService;
import com.thinkive.fxc.ismp.bus.base.business.vo.BusinessTypeInfoVo;
import com.thinkive.fxc.ismp.bus.base.common.ISMPBaseFunction;
import com.thinkive.fxc.ismp.bus.base.constants.DictionaryConstants;
import com.thinkive.fxc.ismp.bus.base.constants.ErrorCodeCheckInput;
import com.thinkive.server.ResultVo;

/**
 * @描述: 搜索业务办理列表
 * @版权: Copyright (c) 2010
 * @公司: 深圳市思迪信息技术股份有限公司
 * @作者: 田源
 * @版本: 2.0.0 
 * @创建时间: 2016年9月16日 下午1:28:36
 */
public class Function1004430 extends ISMPBaseFunction
{
	
	@Override
	public ResultVo execute() throws Exception
	{
	    //step1:获取入参并校验
		checkInput();
		
		//step2:获取全部业务办理类型（排序）
		String type=getType();//业务支持渠道类型:0：pc/web，1：H5客户端,2:手机端
		BusinessLableService businessLableService = SpringHelper.getBean(BusinessServiceBeanIdConstants.SERVICE_ID_BUSINESSLABLE, BusinessLableService.class);
		List<BusinessTypeInfoVo> infoVos = businessLableService.queryByType(type);
		
		
		//step3:添加热门标签
		List<DataRow> hotLable = new ArrayList<DataRow>();
		if(null != infoVos){
		    for (BusinessTypeInfoVo infoVo : infoVos)
            {
		        //20191205改造  --btype_name 赋值给business_name
		        infoVo.setBusinessName(infoVo.getBtypeName());
		        if (DictionaryConstants.BOL_TRUE.equals(infoVo.getIsHot()))
	            {
	                hotLable.add(infoVo);
	            }
		        
            }
		}
		
		//step4:打包出参
		ResultVo resultVo = new ResultVo();
		resultVo.setResult("allBusiness", infoVos);
		resultVo.setResult("hotLable", hotLable);
		resultVo.setErrorNo(DictionaryConstants.INVOKE_FUNCTION_SUCCESS);
		resultVo.setErrorMsg(DictionaryConstants.INVOKE_FUNCTION_SUCCESSMSG);
		return resultVo;
	}
	
	
	public void checkInput()
	{
	    opSource = getAndCheckBlankStrParam("op_source", ErrorCodeCheckInput.BLANK_OP_SOURCE);
	}
	
	private String getType(){
	    if(BusinessConstants.OP_SOURCE_PC.equals(opSource)){
	        return "0";
	    }else if(BusinessConstants.OP_SOURCE_H5.equals(opSource)){
	        return "1";
	    }else{
	        return "2";
	    }
	}
}
