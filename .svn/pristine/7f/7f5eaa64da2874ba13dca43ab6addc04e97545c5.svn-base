package com.thinkive.fxc.ismp.bus.business.zq.dao.impl;

import java.util.ArrayList;
import java.util.Date;
import java.util.List;

import com.thinkive.base.jdbc.DataRow;
import com.thinkive.base.util.StringUtil;
import com.thinkive.fxc.ismp.bus.base.business.constants.BusinessTableConstants;
import com.thinkive.fxc.ismp.bus.base.business.model.AgreeRecordModel;
import com.thinkive.fxc.ismp.bus.base.common.ISMPBaseDao;
import com.thinkive.fxc.ismp.bus.base.util.ModelUtil;
import com.thinkive.fxc.ismp.bus.business.zq.dao.ZqDao;

public class ZqDaoImpl extends ISMPBaseDao implements ZqDao
{

    @Override
    public List<AgreeRecordModel> queryPDF(long businessId, String zqKnowledge) throws Exception
    {
        StringBuilder sql = new StringBuilder();
        List<String> paramsList = new ArrayList<String>();
        sql.append("SELECT BUSINESS_ID, NODE_ID, AGREE_NO, AGREE_NAME, SIGN_TYPE, SIGN_SOURCE_FLAG, CERT_DN,PROTOCOL_DCSIGN,AGREE_VERSION,AGREE_PATH,SECRET").append("  FROM ").append(BusinessTableConstants.T_ISMP_AGREE_RECORD).append(" WHERE 1=1 ");
        if (0 != businessId)
        {
            sql.append(" AND BUSINESS_ID = ?");
            paramsList.add(String.valueOf(businessId));
        }
        
        if (StringUtil.isNotEmpty(zqKnowledge))
        {
            sql.append(" AND NODE_ID = ?");
            paramsList.add(zqKnowledge);
        }
        List<DataRow> queryResult = this.getJdbcTemplate().query(sql.toString(), paramsList.toArray());
        return ModelUtil.packList(queryResult, AgreeRecordModel.class);
    }

    @Override
    public int updatePDF(AgreeRecordModel agreeRecordModel) throws Exception
    {
        Long businessId = agreeRecordModel.getBusinessId();
        String nodeId = agreeRecordModel.getNodeId();
        agreeRecordModel.setAgreePath(agreeRecordModel.getAgreePath());
        agreeRecordModel.setSecret(agreeRecordModel.getSecret());
        agreeRecordModel.setUpdateDate(new Date());
        int total = this.getJdbcTemplate().update(BusinessTableConstants.T_ISMP_AGREE_RECORD, agreeRecordModel, new String[] { "business_id", "node_id" }, new Object[] { businessId, nodeId });
        return total;
    }
    
}
