package com.thinkive.fxc.ismp.bus.base.basicdata.dao.impl;

import java.util.ArrayList;
import java.util.Date;
import java.util.List;

import org.apache.commons.lang.StringUtils;

import com.thinkive.base.jdbc.DataRow;
import com.thinkive.fxc.ismp.bus.base.basicdata.contants.BaseTableConstants;
import com.thinkive.fxc.ismp.bus.base.basicdata.dao.SurveyQuestionDao;
import com.thinkive.fxc.ismp.bus.base.basicdata.model.SurveyQuestionModel;
import com.thinkive.fxc.ismp.bus.base.common.ISMPBaseDao;
import com.thinkive.fxc.ismp.bus.base.constants.SystemConstants;
import com.thinkive.fxc.ismp.bus.base.util.ModelUtil;

/**
 * @描述: 公共-问卷问题表(T_FXC_SURVEY_QUESTION)数据层接口实现类
 * @版权: Copyright (c) 2010
 * @公司: 深圳市思迪信息技术股份有限公司
 * @作者: 田源
 * @版本: 2.0.0 
 * @创建时间: 2016年8月18日 下午5:04:51
 */
public class SurveyQuestionDaoImpl extends ISMPBaseDao implements SurveyQuestionDao
{

    @Override
    public SurveyQuestionModel add(SurveyQuestionModel surveyQuestionModel) 
    {
        String id=getSeqValue(SystemConstants.DB_ISMP,BaseTableConstants.T_FXC_SURVEY_QUESTION);
        surveyQuestionModel.setId(Long.valueOf(id));
        surveyQuestionModel.setCreateDate(new Date());
        this.getJdbcTemplate().insert(BaseTableConstants.T_FXC_SURVEY_QUESTION, surveyQuestionModel);
        return surveyQuestionModel;
    }

    @Override
    public int update(SurveyQuestionModel surveyQuestionModel) 
    {
        surveyQuestionModel.setUpdateDate(new Date());
        return this.getJdbcTemplate().update(BaseTableConstants.T_FXC_SURVEY_QUESTION, surveyQuestionModel, "ID", surveyQuestionModel.getId());
    }

    @Override
    public SurveyQuestionModel queryById(Long id) 
    {
        StringBuilder sql=new StringBuilder();
        sql.append("SELECT ID,SITE_NO,DESCRIPTION,STATE,SUB_ID,TYPE,EXT_CODE,ORDER_LINE FROM ");
        sql.append(BaseTableConstants.T_FXC_SURVEY_QUESTION);
        sql.append(" WHERE ID = ?");
        DataRow queryResult=this.getJdbcTemplate().queryMap(sql.toString(),new Object[]{id});
        return ModelUtil.packInfo(queryResult, SurveyQuestionModel.class);
    }

    @Override
    @SuppressWarnings("unchecked")
    public List<SurveyQuestionModel> queryBySubIdAndState(Long SubId, String state) 
    {
        if(null == SubId && StringUtils.isBlank(state)){
            return null;
        }
        StringBuilder sql=new StringBuilder();
        List<String> paramsList=new ArrayList<String>();
        sql.append("SELECT ID,SITE_NO,DESCRIPTION,STATE,SUB_ID,TYPE,EXT_CODE,ORDER_LINE FROM ");
        sql.append(BaseTableConstants.T_FXC_SURVEY_QUESTION);
        sql.append(" WHERE 1 = 1");
        if(null != SubId){
            sql.append(" AND SUB_ID = ?");
            paramsList.add(SubId.toString());
        }
        if(StringUtils.isNotBlank(state)){
            sql.append(" AND STATE = ?");
            paramsList.add(state);
        }
        List<DataRow>  dataLists=this.getJdbcTemplate().query(sql.toString(), paramsList.toArray());
        return ModelUtil.packList(dataLists, SurveyQuestionModel.class);
    }
    
}
