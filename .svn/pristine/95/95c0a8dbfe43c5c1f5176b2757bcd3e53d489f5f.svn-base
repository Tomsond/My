/**
 * 
 */
package com.thinkive.fxc.ismp.bus.base.business.dao.impl;

import java.util.Date;

import com.thinkive.base.jdbc.DataRow;
import com.thinkive.fxc.ismp.bus.base.business.constants.BusinessTableConstants;
import com.thinkive.fxc.ismp.bus.base.business.dao.PpTaskLogDao;
import com.thinkive.fxc.ismp.bus.base.business.model.PpTaskLogModel;
import com.thinkive.fxc.ismp.bus.base.common.ISMPBaseDao;
import com.thinkive.fxc.ismp.bus.base.constants.SystemConstants;
import com.thinkive.fxc.ismp.bus.base.util.ModelUtil;

/**
 * @描述: 跑批任务流程日志表 (T_ISMP_PP_TASK_LOG)DAO层 实现类
 * @版权: Copyright (c) 2016 
 * @公司: 深圳市思迪信息技术股份有限公司
 * @作者: 尹杰民
 * @版本: 2.0 
 * @创建时间: 2016年8月16日 上午10:07:25
 */
public class PpTaskLogDaoImpl extends ISMPBaseDao implements PpTaskLogDao
{
    
    @Override
    public PpTaskLogModel add(PpTaskLogModel ppTaskLogModel) 
    {
        String logId = getSeqValue(SystemConstants.DB_ISMP,BusinessTableConstants.T_ISMP_PP_TASK_LOG);
        ppTaskLogModel.setLogId(Long.valueOf(logId));
        ppTaskLogModel.setStartDate(new Date());
        this.getJdbcTemplate().insert(BusinessTableConstants.T_ISMP_PP_TASK_LOG, ppTaskLogModel);
        return ppTaskLogModel;
    }
    
    @Override
    public int update(PpTaskLogModel ppTaskLogModel) 
    {
        ppTaskLogModel.setEndDate(new Date());
        return this.getJdbcTemplate().update(BusinessTableConstants.T_ISMP_PP_TASK_LOG, ppTaskLogModel, "LOG_ID",
                ppTaskLogModel.getLogId());
    }
    
    @Override
    public PpTaskLogModel queryByTaskId(Long taskId) 
    {
        StringBuilder sql = new StringBuilder();
        sql.append("SELECT LOG_ID, TASK_ID, FLOW_ID, EXEC_STATUS, START_DATE, END_DATE, REMARK");
        sql.append("  FROM ");
        sql.append(BusinessTableConstants.T_ISMP_PP_TASK_LOG).append(" WHERE TASK_ID = ? ");
        DataRow queryResult = this.getJdbcTemplate().queryMap(sql.toString(), new Object[] { taskId });
        return ModelUtil.packInfo(queryResult, PpTaskLogModel.class);
    }
    
}
